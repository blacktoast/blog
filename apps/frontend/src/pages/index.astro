---
import Header from '@/components/Header.astro';
import Footer from '@/components/Footer.astro';
import Layout from '@/layouts/Layout.astro';
import { Icon } from 'astro-icon/components';
const isPersonal = import.meta.env.PUBLIC_TYPE === 'personal';

---
<Layout isMain={true}>
	<Header />
		<main class="mt-4"> 

			<h1 class="text-4xl max-sm:px-4 font-bold font-HomeHello mb-12">hyggelig!</h1>
			<div class="flex items-center blog-name-container px-4 sm:px-0">
				This is <span id="blog-title-text" class="ml-2 text-lg px-2 inline-flex items-center gap-1 transition-all duration-500 ease-in-out special-font relative overflow-hidden" >
					<span class="title-text text-xl text-transparent bg-clip-text">Retto's Blog</span>
					<span class="title-flag text-xl"/>
				</span>
			</div>
			<section class="intro-section mt-6 mb-16 mx-0 sm:px-0">
				<div class="intro-content max-w-3xl">
					<p class="intro-greeting text-xl font-medium mb-4 text-foreground">
						Hi, I'm Retto!
					</p>
					<p class="intro-description text-base leading-relaxed mb-6 text-foreground/90">
						I'm a frontend engineer working in the web3 industry. 
						<br/>
						<br/>
						This blog is a space where I share my personal stories, things I've learned, and knowledge I want to pass on to others.
					</p>
				<details class="section-guide mt-6" open>
					<summary class="cursor-pointer text-sm text-foreground/70 hover:text-foreground transition-colors list-none">
						<span class="inline-flex items-center gap-2">
							<span>Section guide</span>
							<Icon name="lucide:chevron-down" class="chevron-icon w-4 h-4 transition-transform" />
						</span>
						<p class="intro-note text-sm text-foreground/70">
							For those who prefer to skip personal content, here's a guide to each section
						</p>
					</summary>
					<div class="sections-grid grid grid-cols-1 md:grid-cols-3 gap-3 mt-4">
						<a href="/blog" class="section-card group p-3 rounded-lg border border-border bg-background/50 hover:bg-background/80 transition-all duration-200 hover:border-accent/50">
							<div class="flex items-center gap-3">
								<div class="icon-wrapper shrink-0 w-8 h-8 rounded-md bg-accent/10 group-hover:bg-accent/20 flex items-center justify-center transition-colors">
									<Icon name="lucide:book-open" class="w-4 h-4" />
								</div>
								<div class="flex-1 min-w-0">
									<h3 class="font-semibold text-sm text-foreground group-hover:text-accent transition-colors">Blog</h3>
									<p class="text-xs text-foreground/60 leading-snug mt-0.5">
										Well-organized articles
									</p>
								</div>
							</div>
						</a>

						<a href="/pebbles" class="section-card group p-3 rounded-lg border border-border bg-background/50 hover:bg-background/80 transition-all duration-200 hover:border-accent/50">
							<div class="flex items-center gap-3">
								<div class="icon-wrapper shrink-0 w-8 h-8 rounded-md bg-accent/10 group-hover:bg-accent/20 flex items-center justify-center transition-colors">
									<span class="text-lg">ü™®</span>
								</div>
								<div class="flex-1 min-w-0">
									<h3 class="font-semibold text-sm text-foreground group-hover:text-accent transition-colors">Pebbles</h3>
									<p class="text-xs text-foreground/60 leading-snug mt-0.5">
										TIL and learning drafts
									</p>
								</div>
							</div>
						</a>
						{isPersonal ? (
							<a href="/log" class="section-card group p-3 rounded-lg border border-border bg-background/50 hover:bg-background/80 transition-all duration-200 hover:border-accent/50">
								<div class="flex items-center gap-3">
									<div class="icon-wrapper shrink-0 w-8 h-8 rounded-md bg-accent/10 group-hover:bg-accent/20 flex items-center justify-center transition-colors">
										<Icon name="lucide:scroll-text" class="w-4 h-4" />
									</div>
									<div class="flex-1 min-w-0">
										<h3 class="font-semibold text-sm text-foreground group-hover:text-accent transition-colors">Log</h3>
										<p class="text-xs text-foreground/60 leading-snug mt-0.5">
											Personal thoughts
										</p>
									</div>
								</div>
							</a>
						) : null}

				</details>

				{!isPersonal ? (
					<p class="text-sm text-foreground/40 leading-relaxed mt-4">
						Want to get closer to me or become better friends?
						<br/>
						Here's where you'll find my personal story. <a href="https://personal.haedal.blog/" class="text-accent">Click here</a>
						<br/>
						<span class="text-red-400/90 text-sm">
							Disclaimer: This contains my personal story, so please don't click carelessly. 
						</span>
					</p>
					) : null}
			</div>
			</section>
		</main>
		<Footer />
</Layout>

<style>	
	.blog-name-container{
	}

	.intro-section {
		max-width: 72ch;
	}

	.section-guide summary {
		list-style: none;
	}

	.section-guide summary::-webkit-details-marker {
		display: none;
	}

	.section-guide[open] summary .chevron-icon {
		transform: rotate(180deg);
	}

	.section-card {
		text-decoration: none;
	}

	.section-card:focus-visible {
		outline: 2px dashed var(--color-accent);
		outline-offset: 2px;
	}

	@media (max-width: 768px) {
		.sections-grid {
			grid-template-columns: 1fr;
		}
	}
	.font-HomeHello {
		font-family: 'HomeHello', sans-serif;
	}

	.special-font[data-lang="en"] {
		font-family: 'en-blog', sans-serif;
		font-weight: 700;
	}

	.special-font[data-lang="no"] {
		font-family: 'FRLogo', sans-serif;
	}

	.special-font[data-lang="ja"] {
		font-family: 'JPLogo', sans-serif !important;
		font-weight: 900!;
	}
	
	.special-font[data-lang="zh"] {
		font-family: 'ZHLogo', sans-serif;
		font-weight: normal;
	}
	
	.special-font[data-lang="fr"] {
		font-family: 'FRLogo', sans-serif;
	}
	
	#blog-title-text {
		display: inline-flex;
		align-items: center;
		gap: 0.2rem;
		padding-inline: 0.4rem;
		letter-spacing: -0.02em;
	}

	#blog-title-text .title-text {
		background-image:
		radial-gradient(circle at 6% 25%, rgba(15, 23, 42, 0.85), transparent 45%),
		radial-gradient(circle at 90% 5%, rgba(30, 64, 175, 0.65), transparent 40%),
		conic-gradient(from 140deg at 50% 50%, #0f172a, #1e1b4b, #312e81, #4c1d95, #5b21b6, #7c3aed, #c026d3, #f97316, #fde047, #0f172a);
		background-size: 180% 180%;
		background-position: 50% 100%;
		color: transparent;
		-webkit-text-fill-color: transparent;
		-webkit-background-clip: text;
		background-clip: text;
	}

	#blog-title-text .title-flag {
		color: inherit;
	}

	#blog-title-text::after {
		content: '';
		position: absolute;
		inset: 25% auto auto 12%;
		width: 68%;
		height: 35%;
		border-radius: 9999px;
		filter: blur(18px);
		opacity: 0.8;
		pointer-events: none;
		mix-blend-mode: screen;
	}

	:global(html[data-theme="dark"]) #blog-title-text {
		filter: drop-shadow(0 18px 28px rgba(16, 185, 129, 0.45));
	}

	:global(html[data-theme="dark"]) #blog-title-text .title-text {
		background-image:
		radial-gradient(circle at 5% 18%, rgba(255, 255, 255, 0.7), transparent 48%),
		radial-gradient(circle at 85% 5%, rgba(248, 250, 252, 0.55), transparent 42%),
		conic-gradient(from 210deg at 50% 50%, #ffffff, #f8fafc, #e0f2fe, #d1fae5, #fef3c7, #bacadc);
		background-size: 180% 180%;
		background-position: 100% 59%;
	}
</style>

<script is:inline data-astro-rerun>
	(function() {
		const titles = [
			{ text: "Retto's blog", flag: 'üá∫üá∏', lang: 'en' },    // ÏòÅÏñ¥
			{ text: '„É©„ÉÉ„Ç≥„ÅÆ„Éñ„É≠„Ç∞', flag: 'üáØüáµ', lang: 'ja' },    // ÏùºÎ≥∏Ïñ¥
			{ text: 'Êµ∑Áç≠ÁöÑÂçöÂÆ¢', flag: 'üá®üá≥', lang: 'zh' },      // Ï§ëÍµ≠Ïñ¥
			{ text: 'Le Blog de Loutre', flag: 'üá´üá∑', lang: 'fr' } ,   // ÌîÑÎûëÏä§Ïñ¥
			{ text: "Sj√∏oter's Blog", flag: 'üá≥üá¥', lang: 'no' } ,    // ÎÖ∏Î•¥Ïõ®Ïù¥Ïñ¥
		];
		const INTERVAL_DURATION = 5000; 
		// Í∞Å Ïñ∏Ïñ¥Î≥ÑÎ°ú ÎØ∏Î¶¨ Î°úÎî©Ìï† Ìè∞Ìä∏ Ïä§Ìéô Ï†ïÏùò
		const fontWarmupSpecs = {
			en: '700 20px "en-blog"',
			ja: '900 20px "JPLogo"',
			zh: '400 20px "ZHLogo"',
			fr: '700 20px "FRLogo"',
			no: '700 20px "FRLogo"',
		};

		function warmFontForLang(lang) {
			const spec = fontWarmupSpecs[lang];
			if (!spec || !document.fonts) return;
			document.fonts.load(spec);
		}

		function warmNextFont(index) {
			const nextIndex = (index + 1) % titles.length;
			warmFontForLang(titles[nextIndex].lang);
		}
		
		if (!window.__siteTitleState) {
			window.__siteTitleState = {
				currentIndex: 0,
				lastUpdateTime: Date.now(),
				intervalId: null
			};
		}
		
		const state = window.__siteTitleState;
		const now = Date.now();
		const timeSinceLastUpdate = now - state.lastUpdateTime;
		
		// Í≤ΩÍ≥ºÌïú ÏãúÍ∞ÑÎßåÌÅº Ïù∏Îç±Ïä§ ÏßÑÌñâ
		if (timeSinceLastUpdate > 0) {
			const intervalsPassed = Math.floor(timeSinceLastUpdate / INTERVAL_DURATION);
			state.currentIndex = (state.currentIndex + intervalsPassed) % titles.length;
		}

		function applyTitle(titleElement, index) {
			const title = titles[index];
			const textSpan = titleElement.querySelector('.title-text');
			const flagSpan = titleElement.querySelector('.title-flag');
			if (textSpan) {
				textSpan.textContent = title.text;
			}
			if (flagSpan) {
				flagSpan.textContent = title.flag;
			}
			titleElement.setAttribute('data-lang', title.lang);
		}

		function initTitleRotation() {
			const titleElement = document.getElementById('blog-title-text');
			if (!titleElement) {
				setTimeout(initTitleRotation, 100);
				return;
			}

			// ÌòÑÏû¨ Î∞è Îã§Ïùå Ìè∞Ìä∏Î•º ÎØ∏Î¶¨ Î°úÎî©ÌïòÏó¨ ÌîåÎûòÏãúÎ•º Ï§ÑÏù∏Îã§.
			warmFontForLang(titles[state.currentIndex].lang);
			warmNextFont(state.currentIndex);

			// Í∏∞Ï°¥ Ïù∏ÌÑ∞Î≤å Ï†ïÎ¶¨
			if (state.intervalId) {
				clearInterval(state.intervalId);
			}

			applyTitle(titleElement, state.currentIndex);
			titleElement.style.transform = 'translateY(0)';
			titleElement.style.opacity = '1';

			function rotateTitle() {
				titleElement.style.transform = 'translateY(-100%)';
				titleElement.style.opacity = '0';
				
				setTimeout(() => {
					// Îã§Ïùå ÌÖçÏä§Ìä∏Î°ú Î≥ÄÍ≤Ω
					state.currentIndex = (state.currentIndex + 1) % titles.length;
					state.lastUpdateTime = Date.now();
					applyTitle(titleElement, state.currentIndex);
					warmNextFont(state.currentIndex);
					
					titleElement.style.transform = 'translateY(100%)';
					titleElement.style.opacity = '0';
					
					requestAnimationFrame(() => {
						requestAnimationFrame(() => {
							titleElement.style.transform = 'translateY(0)';
							titleElement.style.opacity = '1';
						});
					});
				}, 250);
			}

			// Îã§Ïùå Î≥ÄÍ≤ΩÍπåÏßÄ ÎÇ®ÏùÄ ÏãúÍ∞Ñ Í≥ÑÏÇ∞
			const timeUntilNextChange = timeSinceLastUpdate >= INTERVAL_DURATION 
				? INTERVAL_DURATION 
				: INTERVAL_DURATION - (timeSinceLastUpdate % INTERVAL_DURATION);
			
			// ÎÇ®ÏùÄ ÏãúÍ∞Ñ ÌõÑ Ï≤´ Î≥ÄÍ≤Ω, Í∑∏ Îã§ÏùåÎ∂ÄÌÑ∞Îäî Ï†ïÍ∏∞Ï†ÅÏúºÎ°ú Î≥ÄÍ≤Ω
			setTimeout(() => {
				rotateTitle();
				state.intervalId = setInterval(rotateTitle, INTERVAL_DURATION);
			}, timeUntilNextChange);
		}

		// DOMÏù¥ Î°úÎìúÎêú ÌõÑ Ïã§Ìñâ
		if (document.readyState === 'loading') {
			document.addEventListener('DOMContentLoaded', initTitleRotation);
		} else {
			initTitleRotation();
		}
	})();
</script>
