---
import Header from '@/components/Header.astro';
import FormattedDate from '@/components/FormattedDate.astro';
import Layout from '@/layouts/Layout.astro';
import { getCollection } from 'astro:content';
import { Icon } from 'astro-icon/components';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

const pageTitle = 'Posts';
const pageDescription = "All the articles I've posted.";
---

<Layout title={pageTitle} description={pageDescription}>
	<Header />
	<main 
		class="flex flex-col gap-10 w-full max-w-[780px] mx-auto px-6 pt-12 pb-20 text-inherit max-sm:px-5 max-sm:py-10" 
		aria-labelledby="posts-heading"
	>
		<section class="flex flex-col gap-2 mb-4">
			<h1 id="posts-heading" class="m-0 text-3xl font-bold text-foreground tracking-tight">{pageTitle}</h1>
			<p class="m-0 text-muted text-lg">{pageDescription}</p>
		</section>

		<section aria-label="Blog posts">
			<ul class="list-none m-0 p-0 flex flex-col gap-8">
				{
					posts.map((post) => {
						const displayDate =
							post.data.updatedDate ?? post.data.pubDate;
						const tags = post.data.tags ?? [];

						return (
							<li class="flex flex-col gap-2 pb-8 border-b border-border/50 last:border-0">
								<a 
									class="text-xl font-semibold text-foreground no-underline hover:text-accent transition-colors duration-200" 
									href={`/blog/${post.id}/`}
								>
									{post.data.title}
								</a>
								<div class="flex items-center gap-4 text-sm text-muted">
									<div class="flex items-center gap-1.5">
										<Icon name="lucide:calendar" class="w-4 h-4" />
										<FormattedDate date={displayDate} />
									</div>
									{
										tags.length > 0 && (
											<div class="flex items-center gap-2">
												{
													tags.map((tag) => (
														<span class="flex items-center gap-1 bg-muted/10 px-2 py-0.5 rounded text-xs font-medium text-muted-foreground">
                                                            <Icon name="lucide:hash" class="w-3 h-3" />
															{tag}
														</span>
													))
												}
											</div>
										)
									}
								</div>
								{post.data.description && (
                                    <p class="m-0 text-muted-foreground leading-relaxed text-base line-clamp-2">
                                        {post.data.description}
                                    </p>
                                )}
							</li>
						);
					})
				}
			</ul>
		</section>
	</main>
</Layout>
