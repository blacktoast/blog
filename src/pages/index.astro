---
import Header from '@/components/Header.astro';
import Footer from '@/components/Footer.astro';
import Layout from '@/layouts/Layout.astro';

---

<Layout>
	<Header />
		<main> 
			<h1 class="text-3xl font-bold">ğŸ§‘â€ğŸš€ Hello, Astronaut!</h1>
			<p class="flex items-center">
				Hello, this is <span id="blog-title-text" class="px-2 inline-block transition-all duration-500 ease-in-out special-font relative overflow-hidden" />!
			</p>
		</main>
		<Footer />
</Layout>

<style>	
	.special-font {
		font-weight: 900;
	}
	
	.special-font[data-lang="it"] {
		font-family: 'JPLogo', sans-serif;
	}
	
	.special-font[data-lang="ko"] {
		font-family: 'JPLogo', sans-serif;
	}
	
	.special-font[data-lang="ja"] {
		font-family: 'JPLogo-2', 'JPLogo', sans-serif;
		font-weight: normal;
	}
	
	.special-font[data-lang="zh"] {
		font-family: 'JPLogo-2', 'JPLogo', sans-serif;
		font-weight: normal;
	}
	
	.special-font[data-lang="fr"] {
		font-family: 'JPLogo', sans-serif;
	}
	
	#blog-title-text {
		display: inline-block;
		will-change: transform, opacity;
	}
</style>

<script is:inline data-astro-rerun>
	(function() {
		const titles = [
		  { text: 'ë ˆë˜ì˜ ë¸”ë¡œê·¸ ğŸ‡°ğŸ‡·', lang: 'ko' },      // í•œêµ­ì–´
			{ text: "Retto's blog ğŸ‡ºğŸ‡¸", lang: 'en' },    // ì˜ì–´
			{ text: 'ãƒ©ãƒƒã‚³ã®ãƒ–ãƒ­ã‚° ğŸ‡¯ğŸ‡µ', lang: 'ja' },    // ì¼ë³¸ì–´
			{ text: 'æµ·çºçš„åšå®¢ ğŸ‡¨ğŸ‡³', lang: 'zh' },      // ì¤‘êµ­ì–´
			{ text: 'Le Blog de Loutre ğŸ‡«ğŸ‡·', lang: 'fr' } ,   // í”„ë‘ìŠ¤ì–´
			{ text: 'SjÃ¸oterâ€™s Blog ğŸ‡³ğŸ‡´', lang: 'no' } ,    // ë…¸ë¥´ì›¨ì´ì–´
		];
		const INTERVAL_DURATION = 2000; // 2ì´ˆ
		
		if (!window.__siteTitleState) {
			window.__siteTitleState = {
				currentIndex: 0,
				lastUpdateTime: Date.now(),
				intervalId: null
			};
		}
		
		const state = window.__siteTitleState;
		const now = Date.now();
		const timeSinceLastUpdate = now - state.lastUpdateTime;
		
		// ê²½ê³¼í•œ ì‹œê°„ë§Œí¼ ì¸ë±ìŠ¤ ì§„í–‰
		if (timeSinceLastUpdate > 0) {
			const intervalsPassed = Math.floor(timeSinceLastUpdate / INTERVAL_DURATION);
			state.currentIndex = (state.currentIndex + intervalsPassed) % titles.length;
		}

		function applyTitle(titleElement, index) {
			const title = titles[index];
			titleElement.textContent = title.text;
			titleElement.setAttribute('data-lang', title.lang);
		}

		function initTitleRotation() {
			const titleElement = document.getElementById('blog-title-text');
			if (!titleElement) {
				setTimeout(initTitleRotation, 100);
				return;
			}

			// ê¸°ì¡´ ì¸í„°ë²Œ ì •ë¦¬
			if (state.intervalId) {
				clearInterval(state.intervalId);
			}

			applyTitle(titleElement, state.currentIndex);
			titleElement.style.transform = 'translateY(0)';
			titleElement.style.opacity = '1';

			function rotateTitle() {
				titleElement.style.transform = 'translateY(-100%)';
				titleElement.style.opacity = '0';
				
				setTimeout(() => {
					// ë‹¤ìŒ í…ìŠ¤íŠ¸ë¡œ ë³€ê²½
					state.currentIndex = (state.currentIndex + 1) % titles.length;
					state.lastUpdateTime = Date.now();
					applyTitle(titleElement, state.currentIndex);
					
					titleElement.style.transform = 'translateY(100%)';
					titleElement.style.opacity = '0';
					
					requestAnimationFrame(() => {
						requestAnimationFrame(() => {
							titleElement.style.transform = 'translateY(0)';
							titleElement.style.opacity = '1';
						});
					});
				}, 250);
			}

			// ë‹¤ìŒ ë³€ê²½ê¹Œì§€ ë‚¨ì€ ì‹œê°„ ê³„ì‚°
			const timeUntilNextChange = timeSinceLastUpdate >= INTERVAL_DURATION 
				? INTERVAL_DURATION 
				: INTERVAL_DURATION - (timeSinceLastUpdate % INTERVAL_DURATION);
			
			// ë‚¨ì€ ì‹œê°„ í›„ ì²« ë³€ê²½, ê·¸ ë‹¤ìŒë¶€í„°ëŠ” ì •ê¸°ì ìœ¼ë¡œ ë³€ê²½
			setTimeout(() => {
				rotateTitle();
				state.intervalId = setInterval(rotateTitle, INTERVAL_DURATION);
			}, timeUntilNextChange);
		}

		// DOMì´ ë¡œë“œëœ í›„ ì‹¤í–‰
		if (document.readyState === 'loading') {
			document.addEventListener('DOMContentLoaded', initTitleRotation);
		} else {
			initTitleRotation();
		}
	})();
</script>