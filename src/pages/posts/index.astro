---
import Header from '@/components/Header.astro';
import FormattedDate from '@/components/FormattedDate.astro';
import Layout from '@/layouts/Layout.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

const pageTitle = 'Posts';
const pageDescription = "All the articles I've posted.";
---

<Layout title={pageTitle} description={pageDescription}>
	<div class="haedal-surface">
		<Header />
		<main class="haedal-theme" aria-labelledby="posts-heading">
			<section class="posts-hero">
				<p class="breadcrumb">
					<a href="/">Home</a>
					<span aria-hidden="true">Â»</span>
					<span>Posts</span>
					<span class="page-indicator">(Page 1)</span>
				</p>
				<h1 id="posts-heading">{pageTitle}</h1>
				<p class="subtitle">{pageDescription}</p>
			</section>

			<section aria-label="Blog posts">
				<ul class="posts-list">
					{
						posts.map((post) => {
							const displayDate =
								post.data.updatedDate ?? post.data.pubDate;
							const tags = post.data.tags ?? [];

							return (
								<li class="post-card">
									<a class="post-title" href={`/blog/${post.id}/`}>
										{post.data.title}
									</a>
									<div class="post-meta">
										<span class="meta-icon" aria-hidden="true">ðŸ“…</span>
										<span class="meta-label">Updated</span>
										<span class="meta-date">
											<FormattedDate date={displayDate} />
										</span>
										{
											tags.length > 0 && (
												<ul class="tag-list" aria-label="Tags">
													{
														tags.map((tag) => (
															<li class="tag-pill">
																<span aria-hidden="true">ðŸ¦¦</span>
																{tag}
															</li>
														))
													}
												</ul>
											)
										}
									</div>
									<p class="post-summary">{post.data.description}</p>
								</li>
							);
						})
					}
				</ul>
			</section>
		</main>
	</div>
</Layout>

<style>
	:root {
		--haedal-bg-start: #16233a;
		--haedal-bg-end: #0b1421;
		--haedal-surface: rgba(255, 255, 255, 0.06);
		--haedal-border: rgba(255, 255, 255, 0.1);
		--haedal-accent: #f9a826;
		--haedal-text-muted: rgba(236, 242, 255, 0.75);
	}

	.haedal-surface {
		min-height: 100vh;
		background: radial-gradient(
				circle at top,
				rgba(61, 102, 173, 0.35),
				transparent 55%
			),
			radial-gradient(
				circle at 80% 20%,
				rgba(255, 168, 61, 0.2),
				transparent 50%
			),
			linear-gradient(145deg, var(--haedal-bg-start), var(--haedal-bg-end));
		color: #f6f7fb;
	}

	:global(.haedal-surface header) {
		background: transparent;
		border-bottom-color: var(--haedal-border);
		color: inherit;
	}

	:global(.haedal-surface header a) {
		color: inherit;
	}

	:global(.haedal-surface header a:hover),
	:global(.haedal-surface header a:focus-visible) {
		color: var(--haedal-accent);
	}

	:global(.haedal-surface #theme-btn) {
		border-color: var(--haedal-border);
	}

	:global(.haedal-surface #theme-btn:hover),
	:global(.haedal-surface #theme-btn:focus-visible) {
		border-color: var(--haedal-accent);
	}

	.haedal-theme {
		display: flex;
		flex-direction: column;
		gap: 3.5rem;
		width: 100%;
		max-width: 780px;
		margin: 0 auto;
		padding: 4rem 1.5rem 5rem;
		color: inherit;
	}

	.posts-hero {
		display: flex;
		flex-direction: column;
		gap: 0.75rem;
	}

	.breadcrumb {
		display: flex;
		align-items: center;
		gap: 0.5rem;
		margin: 0;
		font-size: 0.95rem;
		color: var(--haedal-text-muted);
	}

	.breadcrumb a {
		color: inherit;
		text-decoration: none;
		position: relative;
	}

	.breadcrumb a::after {
		content: '';
		position: absolute;
		left: 0;
		bottom: -0.2rem;
		width: 100%;
		height: 1px;
		background: currentColor;
		opacity: 0;
		transform: scaleX(0);
		transform-origin: left;
		transition: transform 160ms ease, opacity 160ms ease;
	}

	.breadcrumb a:hover::after,
	.breadcrumb a:focus-visible::after {
		opacity: 1;
		transform: scaleX(1);
	}

	.breadcrumb span[aria-hidden='true'] {
		color: var(--haedal-text-muted);
	}

	.page-indicator {
		margin-left: 0.25rem;
		color: var(--haedal-text-muted);
		font-size: 0.9rem;
	}

	h1 {
		margin: 0;
		font-size: clamp(2.25rem, 4vw, 3rem);
		font-weight: 700;
		color: #ffffff;
	}

	.subtitle {
		margin: 0;
		font-size: 1.1rem;
		color: var(--haedal-text-muted);
		max-width: 32rem;
	}

	.posts-list {
		list-style: none;
		margin: 0;
		padding: 0;
		display: flex;
		flex-direction: column;
		gap: 2.5rem;
	}

	.post-card {
		display: flex;
		flex-direction: column;
		gap: 0.85rem;
		padding-bottom: 2.2rem;
		border-bottom: 1px solid var(--haedal-border);
	}

	.post-title {
		font-size: clamp(1.6rem, 3vw, 1.9rem);
		font-weight: 700;
		color: var(--haedal-accent);
		text-decoration: none;
		display: inline-flex;
		align-items: center;
		gap: 0.5rem;
		transition: transform 160ms ease, text-shadow 160ms ease;
	}

	.post-title:hover,
	.post-title:focus-visible {
		transform: translateY(-2px);
		text-shadow: 0 10px 20px rgba(249, 168, 38, 0.35);
	}

	.post-meta {
		display: flex;
		align-items: center;
		gap: 0.65rem;
		flex-wrap: wrap;
		font-size: 0.95rem;
		color: var(--haedal-text-muted);
	}

	.meta-icon {
		font-size: 1.05rem;
	}

	.meta-label {
		font-weight: 600;
		text-transform: uppercase;
		letter-spacing: 0.08em;
	}

	.meta-date time {
		color: #fff;
		font-weight: 500;
	}

	.tag-list {
		display: flex;
		align-items: center;
		gap: 0.5rem;
		margin: 0 0 0 0.5rem;
		padding: 0;
		list-style: none;
	}

	.tag-pill {
		display: inline-flex;
		align-items: center;
		gap: 0.35rem;
		padding: 0.35rem 0.8rem;
		border-radius: 999px;
		background: var(--haedal-surface);
		border: 1px solid rgba(255, 255, 255, 0.12);
		color: #ffffff;
		font-size: 0.85rem;
		font-weight: 600;
		transition: transform 160ms ease, background 160ms ease;
	}

	.tag-pill span {
		font-size: 0.95rem;
	}

	.tag-pill:hover,
	.tag-pill:focus-visible {
		transform: translateY(-1px);
		background: rgba(249, 168, 38, 0.15);
	}

	.post-summary {
		margin: 0;
		color: var(--haedal-text-muted);
		line-height: 1.7;
		font-size: 1.05rem;
		max-width: 40rem;
	}

	@media (max-width: 720px) {
		.haedal-theme {
			padding: 3.5rem 1.25rem 4rem;
		}

		.post-card {
			padding-bottom: 1.8rem;
		}

		.post-meta {
			gap: 0.5rem;
		}

		.tag-list {
			margin-left: 0;
		}
	}
</style>

