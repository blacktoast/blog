---
import { Image } from 'astro:assets';
import type { CollectionEntry } from 'astro:content';
import Footer from '../components/Footer.astro';
import FormattedDate from '../components/FormattedDate.astro';
import Header from '../components/Header.astro';
import Layout from '@/layouts/Layout.astro';

type Props = CollectionEntry<'blog'>['data'];

const { title, description, pubDate, updatedDate, heroImage } = Astro.props;
---

<Layout
	 title={title}
	 description={description}
	 pubDatetime={pubDate}
	 modDatetime={updatedDate ?? null}
	 ogImage={heroImage ? heroImage.src : undefined}
>
	<Header />
	<main >
		<article class="app-prose">
			<div class="hero-image">
				{heroImage && <Image width={1020} height={510} src={heroImage} alt="" />}
			</div>
			<div>
				<div class="title">
					<div class="date">
						<FormattedDate date={pubDate} />
						{
							updatedDate && (
								<div class="last-updated-on">
									Last updated on <FormattedDate date={updatedDate} />
								</div>
							)
						}
					</div>
					<h1>{title}</h1>
					<hr />
				</div>
				<slot />
			</div>
		</article>
	</main>
	<Footer />
</Layout>

<script is:inline data-astro-rerun>
  (function () {
    /** Create a progress indicator
   *  at the top */
  function createProgressBar() {
    // Create the main container div
    const progressContainer = document.createElement("div");
    progressContainer.className =
      "progress-container fixed top-0 z-10 h-1 w-full bg-background";

    // Create the progress bar div
    const progressBar = document.createElement("div");
    progressBar.className = "progress-bar h-1 w-0 bg-accent";
    progressBar.id = "myBar";

    // Append the progress bar to the progress container
    progressContainer.appendChild(progressBar);

    // Append the progress container to the document body or any other desired parent element
    document.body.appendChild(progressContainer);
  }
  createProgressBar();

  /** Update the progress bar
   *  when user scrolls */
  function updateScrollProgress() {
    document.addEventListener("scroll", () => {
      const winScroll =
        document.body.scrollTop || document.documentElement.scrollTop;
      const height =
        document.documentElement.scrollHeight -
        document.documentElement.clientHeight;
      const scrolled = (winScroll / height) * 100;
      if (document) {
        const myBar = document.getElementById("myBar");
        if (myBar) {
          myBar.style.width = scrolled + "%";
        }
      }
    });
  }
  updateScrollProgress();
	
  })();
</script>

<style>
	article {
		display: flex;
		flex-direction: column;
		gap: 2rem;
	}
	.hero-image {
		width: 100%;
	}
	.hero-image img {
		display: block;
		margin: 0 auto;
		border-radius: 12px;
		border: 1px solid var(--color-border);
	}
	.title {
		margin-bottom: 1em;
		padding: 1em 0;
		text-align: center;
		line-height: 1;
	}
	.title h1 {
		margin: 0 0 0.5em 0;
	}
	.date {
		margin-bottom: 0.5em;
		color: var(--color-foreground);
		opacity: 0.85;
	}
	.last-updated-on {
		font-style: italic;
	}
	hr {
		border-color: var(--color-border);
	}
</style>
